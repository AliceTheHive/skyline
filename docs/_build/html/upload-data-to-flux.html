

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>upload_data to Flux - EXPERIMENTAL &mdash; Skyline 2.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/skyline.styles.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Skyline 2.0.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Skyline
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-in-python-virtualenv.html">Running Skyline in a Python virtualenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-in-python-virtualenv-py2.html">Running Skyline in a Python 2.7 virtualenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-data-into-skyline.html">Getting data into Skyline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alert-testing.html">Alert testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="alerts.html">Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">docker - EXPERIMENTAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">slack</a></li>
<li class="toctree-l1"><a class="reference internal" href="monotonic-metrics.html">Strictly increasing monotonicity</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizon.html">Horizon</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzer.html">Analyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzer-optimizations.html">Analyzer Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirage.html">Mirage</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary.html">Boundary</a></li>
<li class="toctree-l1"><a class="reference internal" href="crucible.html">Crucible</a></li>
<li class="toctree-l1"><a class="reference internal" href="panorama.html">Panorama</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp.html">Webapp</a></li>
<li class="toctree-l1"><a class="reference internal" href="ionosphere.html">Ionosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="ionosphere_echo.html">Ionosphere echo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tsfresh.html">tsfresh</a></li>
<li class="toctree-l1"><a class="reference internal" href="luminosity.html">Luminosity</a></li>
<li class="toctree-l1"><a class="reference internal" href="flux.html">Flux</a></li>
<li class="toctree-l1"><a class="reference internal" href="vista.html">Vista</a></li>
<li class="toctree-l1"><a class="reference internal" href="redis-integration.html">Redis integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="rebrow.html"><span class="red">re</span><span class="brow">brow</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="running-multiple-skylines.html">Running multiple Skyline instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyline-and-friends.html">Skyline and friends</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html">Tuning tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html#smaller-deployments">Smaller deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html#reliability">Reliability</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring-skyline.html">Monitoring Skyline</a></li>
<li class="toctree-l1"><a class="reference internal" href="debian-and-vagrant-installation-tips.html">Debian and Vagrant Installation Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="whats-new.html">What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyline.html">skyline package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Skyline</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>upload_data to Flux - EXPERIMENTAL</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/upload-data-to-flux.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upload-data-to-flux-experimental">
<h1>upload_data to Flux - EXPERIMENTAL<a class="headerlink" href="#upload-data-to-flux-experimental" title="Permalink to this headline">Â¶</a></h1>
<p><strong>POST variables may change as this is a experimental feature</strong></p>
<p><strong>SIMPLE</strong> data files can be uploaded via the /upload_data HTTP/S endpoint for
Flux to process and fed to Graphite.  A number of things need to be enabled and
running to allow for processing data file uploads, which are not enabled by
default.</p>
<p>For information regarding configuring Skyline to allow Flux to process uploaded
data files see the <a class="reference external" href="flux.html#process-uploaded-data">Process uploaded data</a>
section on the Flux page.</p>
<p>Skyline currently allows for the uploading of the following format data files:</p>
<ul class="simple">
<li>csv (tested)</li>
<li>xlsx (tested)</li>
<li>xls (not tested)</li>
</ul>
<p>Seeing as data files can be large, the following archive formats are accepted:</p>
<ul class="simple">
<li>gz (tested)</li>
<li>zip (partly tested, multiple data files per archive have not been thoroughly tested)</li>
</ul>
<p>A single file or archive can be uploaded or many data files can be uploaded in
a single archive.  A <cite>info.csv</cite> must also be included in the archive, more
on that below.  <strong>HOWEVER</strong> if you wish to determine the status of the upload
programmatically you will want to upload one data file per upload, otherwise
making sense of the upload_status will be very difficult.</p>
<p>So you could upload <cite>data.csv</cite>, <cite>data.csv.gz</cite> or <cite>data.zip</cite> with the <cite>data.csv</cite>
file inside the zip archive.</p>
<p>Any files in an archive that are not of an allowed format are not extracted or
they are deleted.</p>
<p>Files names <strong>must only have</strong> alphanumeric, <cite>-</cite>, <cite>_</cite> and <cite>.</cite> characters in them.
File names like <cite>&#8216;2020-05-13-05_devices_99_1(2).xlsx&#8217;</cite> are not acceptable (
no matter what your OS lets you do).  Handling <cite>&#8216;</cite>, <cite>(</cite>, etc in the file names
is not something that will be done.</p>
<p>Multiple data files should be uploaded and processed sequentially.  At the
moment upload the oldest data file first and then after validating the status of
the upload (the /api?upload_status link is return on the Flux_frontend page or
in the json response), continue with the next upload, etc.</p>
<p>Skyline automates the conversion of SIMPLE columnar data into time series data,
however seeing as not all data is defined or created equally, some information
about the data needs to be passed with the data file/s to inform Skyline about
the metric structure.  This makes setting up a upload process more work, but if
you are uploading frequently then it is one off work.</p>
<p>To ensure that naive data in the datetime column  can be handled, meaning not
timezone aware date times e.g. <cite>16-05-2020 11:00</cite> you always need to pass a
valid pytz timezone as listed in <a class="reference external" href="development/pytz.html#timezones-list-for-pytz-version">Timezones list for pytz version</a>.
A timezone aware timestamp either specifies the UTC offset or the timezone
itself.</p>
<ul class="simple">
<li>2020-05-16 14:00:00 -04:00</li>
<li>2020-05-16 07:46:25 BST 2020</li>
</ul>
<p>However the timezone itself may not be a valid pytz timezone, so a valid pytz
timezone must always be passed.</p>
<p>In many instances it is possible that the column names and format in a data file
will not describe the measurements in terms of metrics name or be in a suitable
metric name format.  Take a csv example of a very normal type of data structure,
lets call it 2020-05-16-11.device_id.012383.csv</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Device</span> <span class="n">ID</span><span class="p">,</span><span class="mi">012383</span>
<span class="n">Serial</span> <span class="n">Number</span><span class="p">,</span><span class="mi">1234579853</span>
<span class="n">Location</span><span class="p">,</span><span class="n">Warehouse</span> <span class="mi">2</span>
<span class="n">From</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">2020</span>
<span class="n">To</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">2020</span>
<span class="n">Date</span><span class="p">,</span><span class="n">Roof</span> <span class="n">Temperature</span><span class="p">,</span><span class="n">Floor</span> <span class="n">Temperature</span>
<span class="mi">16</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2020</span> <span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span><span class="mf">45.72</span><span class="p">,</span><span class="mf">22.78</span>
<span class="mi">16</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2020</span> <span class="mi">11</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="mf">45.94</span><span class="p">,</span><span class="mf">22.92</span>
<span class="mi">16</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2020</span> <span class="mi">11</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="mf">46.13</span><span class="p">,</span><span class="mf">22.98</span>
<span class="mi">16</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2020</span> <span class="mi">11</span><span class="p">:</span><span class="mi">45</span><span class="p">,</span><span class="mf">46.34</span><span class="p">,</span><span class="mf">23.06</span>
</pre></div>
</div>
<p>This data informs us of the times and values and things, but it does not tell us
what metrics they should represent.  Skyline also needs to be informed about the
header row and rows to ignore.  A info file is used to inform Skyline how to
read and metric the data, take 2020-05-16-11.device_id.012383.info.json
Note, in processing rows are 0-indexed</p>
<p>info.json</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;parent_metric_namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;temp_monitoring.warehouse.2.012383&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT&quot;</span><span class="p">,</span>
  <span class="s2">&quot;skip_rows&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="s2">&quot;header_row&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;date_orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span><span class="p">,</span>
  <span class="s2">&quot;columns_to_metrics&quot;</span><span class="p">:</span> <span class="s2">&quot;date,roof,floor&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Your date time column MUST be named date in the columns_to_metrics mapping.</p>
<p>For convenience sake you can also add additional elements to the info.json:</p>
<ul class="simple">
<li><cite>&#8220;debug&#8221;: &#8220;true&#8221;</cite> which outputs additional information regarding the imported
dataframe in the flux.log to aid with debugging.</li>
<li><cite>&#8220;dryrun&#8221;: &#8220;true&#8221;</cite> which runs through the processing but does not submit data
to Graphite.</li>
<li><cite>&#8220;ignore_submitted_timestamps&#8221;: &#8220;true&#8221;</cite>, a check is normally done of the last
timestamp submitted to flux for the metric to ensure that data is not
submitted multiple times. If you wish to override this check to resubmit data,
update or override already submitted data pass this in the info.json. However
do <strong>note</strong>,  if you wish to resubmit data that is <strong>NOT IN THE</strong> latest
Graphite retention (old data) this will not have the desired affect as
Graphite down sampling (aggregation) will already have occurred.</li>
</ul>
<p>This tells Skyline what the parent metric namespace should be which would
result in metrics:</p>
<ul class="simple">
<li>temp_monitoring.warehouse.2.012383.roof</li>
<li>temp_monitoring.warehouse.2.012383.floor</li>
</ul>
<p>xlsx files are 0-indexed, csv files are not 0-indexed.</p>
<p>It tells Skyline to ignore rows 1, 2, 3, 4, 5 (but if it were 0-indexed skip_row
would be set to 4).
It tells Skyline to use row 0 as the header row, e.g. column names. Note that
if you skip_rows your header row must be 0.
It tells Skyline how to map the column names to metric names.  A one to one
mapping it required for every column.  Once again, your date time column MUST be
named date in the columns_to_metrics mapping.</p>
<p>Only alphanumeric chars and &#8216;.&#8217;, &#8216;_&#8217;, &#8216;-&#8216; are allowed in the metric name, e.g.
the parent_metric_namespace and columns_to_metrics that you pass.</p>
<p>Requirements of the data file.  The data file must have a header row.</p>
<p>The required information elements are in the POST variables are:</p>
<ul class="simple">
<li>key (str)</li>
<li>parent_metric_namespace (str)</li>
<li>archive (str) - gz, zip or tar_gz</li>
<li>format (str)</li>
<li>skip_rows (&#8216;none&#8217; or int)</li>
<li>header_row (int)</li>
<li>date_orientation (str) - currently only &#8216;rows&#8217; is supported</li>
<li>data_file (required in the post variables)</li>
<li>columns_to_metrics (str) - comma separated list of names (no spaces)</li>
<li>data_file (file)</li>
<li>info_file (file)</li>
<li>json_response</li>
</ul>
<p>An example of how to POST the above csv and info.csv with curl be would be as
follows.  Note that in this instance you would need a your
<a class="reference internal" href="skyline.html#settings.FLUX_UPLOADS_KEYS" title="settings.FLUX_UPLOADS_KEYS"><code class="xref py py-mod docutils literal"><span class="pre">settings.FLUX_UPLOADS_KEYS</span></code></a> to be set with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">FLUX_UPLOADS_KEYS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;temp_monitoring.warehouse.2.012383&#39;</span><span class="p">:</span> <span class="s1">&#39;484166bf-df66-4f7d-ad4a-9336da9ef620&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>curl request.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl <span class="se">\</span>
     -F <span class="s2">&quot;key=484166bf-df66-4f7d-ad4a-9336da9ef620&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;timezone=GMT&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;parent_metric_namespace=temp_monitoring.warehouse.2.012383&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;archive=none&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;format=csv&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;skip_rows=5&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;header_row=0&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;date_orientation=rows&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;columns_to_metrics=date,roof,floor&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;data_file=@&lt;FULL_PATH_TO_FILE&gt;/2020-05-16-11.device_id.012383.csv&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;info_file=@&lt;FULL_PATH_TO_FILE&gt;/info.json&quot;</span> <span class="se">\</span>
     -F <span class="s2">&quot;json_response=true&quot;</span> <span class="se">\</span>
     https://<span class="nv">$SKYLINE_HOST</span>/upload_data
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2014, Etsy Inc; 2015, Abe Stanway; 2015-2020, Gary Wilson.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>